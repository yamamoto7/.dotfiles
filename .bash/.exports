#!/usr/bin/env bash

# ============================================
# Editor
# ============================================
export EDITOR='nvim'
export VISUAL='nvim'

# ============================================
# Language
# ============================================
export LANG='en_US.UTF-8'
export LC_ALL='en_US.UTF-8'

# ============================================
# Silence macOS bash deprecation warning
# ============================================
export BASH_SILENCE_DEPRECATION_WARNING=1

# ============================================
# fzf
# ============================================
export FZF_DEFAULT_OPTS='
  --height=40%
  --layout=reverse
  --border
  --info=inline
  --cycle
  --color=fg:#c0caf5,bg:#1a1b26,hl:#bb9af7
  --color=fg+:#c0caf5,bg+:#292e42,hl+:#7dcfff
  --color=info:#7aa2f7,prompt:#7dcfff,pointer:#7dcfff
  --color=marker:#9ece6a,spinner:#9ece6a,header:#9ece6a
'

# Use fd for fzf if available
if command -v fd &> /dev/null; then
    export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    export FZF_ALT_C_COMMAND='fd --type d --hidden --follow --exclude .git'
fi

# ============================================
# bat (better cat)
# ============================================
export BAT_THEME="Monokai Extended"

# ============================================
# PATH additions (only add existing directories)
# ============================================
_add_to_path() {
    [[ -d "$1" ]] && [[ ":$PATH:" != *":$1:"* ]] && PATH="$1:$PATH"
}

_add_to_path "$HOME/bin"
_add_to_path "$HOME/.local/bin"
_add_to_path "$HOME/flutter/bin"
_add_to_path "$HOME/.pub-cache/bin"

export PATH

# ============================================
# MySQL client (Homebrew on Apple Silicon)
# ============================================
_mysql_prefix="/opt/homebrew/opt/mysql-client"
if [[ -d "$_mysql_prefix" ]]; then
    _add_to_path "$_mysql_prefix/bin"
    export LDFLAGS="-L$_mysql_prefix/lib"
    export CPPFLAGS="-I$_mysql_prefix/include"
fi

# zstd library path (cached to avoid slow brew --prefix on each shell startup)
_zstd_lib="/opt/homebrew/opt/zstd/lib"
[[ -d "$_zstd_lib" ]] && export LIBRARY_PATH="${LIBRARY_PATH:+$LIBRARY_PATH:}$_zstd_lib"

unset _mysql_prefix _zstd_lib

# ============================================
# mise (modern version manager)
# ============================================
if command -v mise &> /dev/null; then
    eval "$(mise activate bash)"
fi

# ============================================
# zoxide (smart cd)
# ============================================
if command -v zoxide &> /dev/null; then
    eval "$(zoxide init bash)"
fi
